import { Header } from "@/components/layout/Header";
import { Footer } from "@/components/layout/Footer";
import { Container } from '@/components/layout/Container';
import Link from 'next/link';
import { Button } from '@/components/ui/button';
import { DatabaseZap } from 'lucide-react';
import React from 'react';

{/* Helper components for styling and structure */}
const SectionTitle = ({ id, children }) => (
  <h2 id={id} className="text-3xl font-bold mt-12 mb-6 border-b-2 border-border pb-3 text-primary">{children}</h2>
);

const SubSectionTitle = ({ id, children }) => (
  <h3 id={id} className="text-2xl font-semibold mt-8 mb-4 text-primary/90">{children}</h3>
);

const InfoBox = ({ title, children }) => (
    <div className="bg-blue-50 border-l-4 border-blue-500 p-6 rounded-r-lg my-6">
        <h4 className="font-bold text-lg mb-2 text-blue-800">{title}</h4>
        <div className="text-blue-900">{children}</div>
    </div>
);

const CodeBlock = ({ language, children }) => (
    <div className="bg-gray-900 text-white p-4 rounded-lg my-4 overflow-x-auto">
        <pre><code className={`language-${language}`}>{children.trim()}</code></pre>
    </div>
);

const ComparisonCard = ({ title, items }) => (
    <div className="bg-card p-6 rounded-lg shadow-md border border-border">
        <h4 className="text-xl font-bold mb-3 text-center text-primary">{title}</h4>
        <ul className="list-disc list-inside space-y-2 text-muted-foreground">
            {items.map((item, index) => <li key={index}>{item}</li>)}
        </ul>
    </div>
);

export default function FirebaseFirestorePage() {
  return (
    <>
      <Header />
      <main>
          <Container className="py-10 md:py-12">
              <div className="text-center mb-12">
                  <DatabaseZap className="h-16 w-16 text-accent mx-auto mb-4" />
                  <h1 className="text-4xl sm:text-5xl md:text-6xl font-bold mb-6 text-primary">Firebase & Firestore for Enterprise Applications</h1>
                  <p className="text-lg text-muted-foreground max-w-3xl mx-auto">
                      Master Google's powerful platform for building scalable, serverless applications with real-time data synchronization. Learn how to integrate Firebase and Firestore into Python and TypeScript applications while implementing enterprise-grade security, data modeling, and offline capabilities.
                  </p>
              </div>

              <section id="ecosystem-overview">
                  <SectionTitle id="ecosystem-title">Understanding the Firebase Ecosystem</SectionTitle>
                  <p className="mb-4 text-muted-foreground">Firebase is a comprehensive development platform that provides a suite of tools and services to build, improve, and grow applications. At its core is Firestore, a flexible, scalable NoSQL cloud database that synchronizes data across clients in real-time.</p>
                  
                  <InfoBox title="Key Components of Firebase">
                      <ul className="list-disc list-inside space-y-2">
                          <li><strong>Cloud Firestore:</strong> NoSQL document database with real-time capabilities.</li>
                          <li><strong>Authentication:</strong> Multi-provider user authentication system.</li>
                          <li><strong>Cloud Functions:</strong> Serverless compute for backend operations.</li>
                          <li><strong>Hosting:</strong> Fast and secure web hosting.</li>
                          <li><strong>Storage:</strong> Object storage for user-generated content.</li>
                          <li><strong>Security Rules:</strong> Declarative security model for data access.</li>
                      </ul>
                  </InfoBox>

                  <div className="grid md:grid-cols-2 gap-8 my-8">
                      <ComparisonCard title="Traditional Backend Architecture" items={[
                          "Server provisioning and maintenance",
                          "Database administration",
                          "Authentication system implementation",
                          "Custom scaling solutions",
                          "Manual security implementation",
                      ]} />
                      <ComparisonCard title="Firebase Architecture" items={[
                          "Serverless, managed infrastructure",
                          "Auto-scaling database",
                          "Built-in authentication",
                          "Automatic scaling based on demand",
                          "Declarative security rules",
                      ]} />
                  </div>
              </section>

              <section id="firestore-fundamentals">
                  <SectionTitle id="firestore-fundamentals-title">Firestore Fundamentals</SectionTitle>
                  <p className="text-muted-foreground">Cloud Firestore is Firebase's flagship NoSQL database solution, designed for flexibility, scalability, and real-time synchronization.</p>
                  
                  <SubSectionTitle id="firestore-datamodeling-title">Data Modeling in Firestore</SubSectionTitle>
                  <p className="text-muted-foreground">Firestore uses a document-collection model. Documents are like JSON objects, and they live inside collections.</p>
                  <CodeBlock language="javascript">{`
// Example Firestore document for a user
{
  name: "John Smith",
  email: "john@example.com",
  role: "admin",
  lastLogin: Timestamp(2025-06-07T12:00:00Z),
  settings: {
    theme: "dark",
    notifications: true
  }
}
                  `}</CodeBlock>
                  <p className="font-semibold mt-4 text-foreground">Data Modeling Best Practices:</p>
                  <ul className="list-disc list-inside space-y-2 mt-2 text-muted-foreground">
                      <li>Denormalize data for faster reads, even if it means duplicating information.</li>
                      <li>Keep documents small (under the 1MB limit) to optimize performance.</li>
                      <li>Use subcollections for one-to-many relationships to keep data organized.</li>
                      <li>Design your data structure based on how you will query it.</li>
                  </ul>
              </section>

              <section id="integration">
                  <SectionTitle id="integration-title">Firebase Integration in TypeScript & Python</SectionTitle>
                  
                  <SubSectionTitle id="typescript-integration-title">TypeScript Integration (Web/Node.js)</SubSectionTitle>
                  <p className="text-muted-foreground">Firebase's JavaScript/TypeScript SDK enables seamless integration in web and Node.js applications with strong typing support.</p>
                  <CodeBlock language="typescript">{`
// Install: npm install firebase

import { initializeApp } from "firebase/app";
import { getFirestore, collection, addDoc } from "firebase/firestore";

const firebaseConfig = { /* Your config object */ };
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// Example: Adding a document
async function addUser(name: string, email: string) {
  try {
    const docRef = await addDoc(collection(db, "users"), {
      name: name,
      email: email,
      createdAt: new Date()
    });
    console.log("Document written with ID: ", docRef.id);
  } catch (e) {
    console.error("Error adding document: ", e);
  }
}
                  `}</CodeBlock>

                  <SubSectionTitle id="realtime-updates-title">Real-time Updates in TypeScript</SubSectionTitle>
                  <p className="text-muted-foreground">One of Firestore's most powerful features is real-time data synchronization using \`onSnapshot\`.</p>
                  <CodeBlock language="typescript">{`
import { collection, query, where, onSnapshot } from "firebase/firestore";

// Listen to a query
const q = query(collection(db, "users"), where("role", "==", "admin"));
const unsubscribe = onSnapshot(q, (querySnapshot) => {
  const adminUsers = [];
  querySnapshot.forEach((doc) => {
      adminUsers.push({ id: doc.id, ...doc.data() });
  });
  console.log("Current admin users: ", adminUsers);
  // Update your React state here, e.g., setAdminUsers(adminUsers)
});

// To stop listening, call the unsubscribe function:
// unsubscribe();
                  `}</CodeBlock>

                  <SubSectionTitle id="python-integration-title">Python Integration (Server-side)</SubSectionTitle>
                  <p className="text-muted-foreground">The Firebase Admin SDK for Python provides server-side capabilities for backend processing and administrative tasks.</p>
                  <CodeBlock language="python">{`
# Install: pip install firebase-admin

import firebase_admin
from firebase_admin import credentials, firestore

cred = credentials.Certificate("path/to/serviceAccountKey.json")
firebase_admin.initialize_app(cred)
db = firestore.client()

# Example: Adding a document
doc_ref = db.collection(u'users').document(u'alovelace')
doc_ref.set({
    u'first': u'Ada',
    u'last': u'Lovelace',
    u'born': 1815
})
                  `}</CodeBlock>
              </section>

              <section id="security-rules">
                  <SectionTitle id="security-rules-title">Firestore Security Rules</SectionTitle>
                  <p className="text-muted-foreground">Security rules are a critical component of Firestore, providing declarative access control directly in the database to protect your data from unauthorized access.</p>
                  <CodeBlock language="javascript">{`
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Only authenticated users can read any document
    match /{document=**} {
      allow read: if request.auth != null;
    }
    
    // Users can only create, update, or delete their own user document
    match /users/{userId} {
      allow write: if request.auth != null && request.auth.uid == userId;
    }
  }
}
                  `}</CodeBlock>
              </section>

              <section id="cloud-functions">
                  <SectionTitle id="cloud-functions-title">Firebase Cloud Functions</SectionTitle>
                  <p className="text-muted-foreground">Cloud Functions for Firebase allows you to run backend code in response to events triggered by Firebase features (like a new document being created) and HTTPS requests, without managing servers.</p>
                  <CodeBlock language="typescript">{`
// Deployed via Firebase CLI: firebase deploy --only functions
// functions/src/index.ts

import * as functions from "firebase-functions";
import * as admin from "firebase-admin";

admin.initializeApp();

// Trigger a function when a new user signs up
export const sendWelcomeEmail = functions.auth.user().onCreate((user) => {
  const email = user.email; // The email of the user.
  // ... logic to send a welcome email
  console.log(\`Sending welcome email to \${email}\`);
  return null;
});

// Trigger a function when a document is created in the 'orders' collection
export const processNewOrder = functions.firestore
  .document('orders/{orderId}')
  .onCreate((snap, context) => {
    const newOrder = snap.data();
    // ... logic to process the new order
    console.log('Processing new order:', context.params.orderId, newOrder);
    return snap.ref.set({ processed: true }, { merge: true });
  });
                  `}</CodeBlock>
              </section>
              
              <div className="text-center mt-16">
                  <Button asChild>
                    <Link href="/training-resources">Back to Curriculum</Link>
                  </Button>
              </div>

          </Container>
      </main>
      <Footer />
    </>
  );
}
